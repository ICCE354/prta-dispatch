<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>PRTA MDT</title>

<style>
body{font-family:Arial;margin:0;background:#9fd3ff}
.page{display:none;padding:20px}
button{padding:10px;margin:5px;background:#1e88e5;color:white;border:none}
input{padding:8px;margin:5px}
table{width:100%;border-collapse:collapse}
td,th{border:1px solid #000;padding:6px;text-align:center}
</style>
</head>

<body>

<!-- LOGIN -->
<div id="login" class="page" style="display:block">
<h2>Login</h2>
<input id="user" placeholder="Username"><br>
<input id="pass" placeholder="Password"><br>
<button onclick="login()">Login</button>
</div>

<!-- DRIVER -->
<div id="driver" class="page">
<h2>Driver MDT</h2>
<button onclick="logout()">Logout</button>

<h3>Schedule</h3>
<table id="driverTable"></table>

<h3>Canned Messages</h3>
<button onclick="sendMsg('Running Late')">Running Late</button>
<button onclick="sendMsg('Traffic Delay')">Traffic Delay</button>
<button onclick="sendMsg('Mechanical Issue')">Mechanical Issue</button>
<button onclick="sendMsg('Customer Declined Shoulder Strap')">
Customer Declined Shoulder Strap</button>

<h3>Messages from Dispatch</h3>
<div id="driverMsgs"></div>
</div>

<!-- DISPATCH -->
<div id="dispatch" class="page">
<h2>Dispatcher</h2>
<button onclick="logout()">Logout</button>

<h3>Create Schedule (5 stops max)</h3>
<input id="dDriver" placeholder="Driver (3675 or 3804)"><br>

<input id="s1" placeholder="Stop 1 time">
<input id="s2" placeholder="Stop 2 time">
<input id="s3" placeholder="Stop 3 time">
<input id="s4" placeholder="Stop 4 time">
<input id="s5" placeholder="Stop 5 time"><br>

<button onclick="assign()">Assign Schedule</button>

<h3>Send Message</h3>
<input id="msgDriver" placeholder="Driver">
<input id="msgText" placeholder="Message">
<button onclick="sendDispatch()">Send</button>

<h3>Driver Messages</h3>
<div id="dispatchMsgs"></div>
</div>

<script>
const users={
"3675":{p:"SR",r:"driver"},
"3804":{p:"ER",r:"driver"},
"dispatcher":{p:"admin",r:"dispatch"}
};

let current=null;
const schedules={};
const messages=[];

/* LOGIN */
function login(){
let u=user.value,p=pass.value;
if(!users[u]||users[u].p!==p){alert("bad login");return;}
current=u;
document.querySelectorAll(".page").forEach(x=>x.style.display="none");
if(users[u].r==="driver"){driver.style.display="block";loadDriver();}
if(users[u].r==="dispatch"){dispatch.style.display="block";}
}

/* LOGOUT */
function logout(){location.reload();}

/* ASSIGN SCHEDULE */
function assign(){
let d=dDriver.value;
if(!d)return;

let times=[s1.value,s2.value,s3.value,s4.value,s5.value].filter(x=>x);

schedules[d]=times.map(t=>({time:t,arrived:false}));
alert("Assigned!");
}

/* DRIVER VIEW */
function loadDriver(){
let list=schedules[current]||[];
driverTable.innerHTML="<tr><th>Time</th><th>Status</th></tr>";
list.forEach((s,i)=>{
let r=driverTable.insertRow();
r.insertCell().innerText=s.time;
let c=r.insertCell();
if(!s.arrived){
c.innerHTML=`<button onclick="arrive(${i})">ARRIVED</button>`;
}else{
c.innerText="Done";
}
});
renderDriverMsgs();
}

/* ARRIVE */
function arrive(i){
schedules[current][i].arrived=true;
if(schedules[current].every(x=>x.arrived)) delete schedules[current];
loadDriver();
}

/* DRIVER MSG */
function sendMsg(text){
messages.push({from:current,text});
renderDispatchMsgs();
}

/* DISPATCH SEND */
function sendDispatch(){
messages.push({to:msgDriver.value,text:msgText.value});
renderDriverMsgs();
}

/* RENDER */
function renderDriverMsgs(){
driverMsgs.innerHTML="";
messages.filter(m=>m.to===current).forEach(m=>{
driverMsgs.innerHTML+=m.text+"<br>";
});
}

function renderDispatchMsgs(){
dispatchMsgs.innerHTML="";
messages.forEach(m=>{
dispatchMsgs.innerHTML+=JSON.stringify(m)+"<br>";
});
}
</script>

</body>
</html>
